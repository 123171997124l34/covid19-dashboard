name: debug issue creation
on: push

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:

    - name: Create an issue if notebook update failure occurs
      uses: actions/github-script@0.6.0
      with:
        github-token: ${{secrets.GITHUB_TOKEN}}
        script: |
          var err = process.env.ERROR_STRING;
          var run_id = process.env.RUN_ID;
          github.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: "Error updating notebooks"
            body: `These are the notebooks that failed to update properly: \n${err}\n\n See run [${run_id}](https://github.com/github/covid19-dashboard/actions/runs/${run_id}) for more details.`
          })
      env:
        ERROR_STRING: ', 2020-03-11-Mortality_Rate.ipynb, 2020-03-13-COVID19-Comparitive-Analysis.ipynb, 2020-03-13-EDA.ipynb, 2020-03-15-us-growth-by-state-map.ipynb, 2020-03-17-covid19-compare-country-death-trajectories.ipynb, 2020-03-21-covid19-overview-us.ipynb, 2020-03-21-covid19-overview.ipynb, 2020-03-23-cumulative-outstanding.ipynb'
        RUN_ID: '123412321'
